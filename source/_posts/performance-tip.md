title: 解刨Java在Linux下的性能优化--命令行装逼篇
date: 2016-04-10 09:29:39
tags:
---
性能问题是一个永恒的话题，而且是一个综合的话题。
- 在平常开发中，你都遇到过哪些性能问题
- 有没有参与一些调优的工作
- 平常你都会怎么做性能优化的
- 工作中有没有遇到一些奇怪的问题

不要懵逼，很多公司都喜欢这么问，因为你的其他方面都非常出色了，实在是不知道还要再考察啥了。那么，装逼的机会到了。接下来我们带中高级工程师飞起来。
条条大路通罗马，曲径通幽装逼时。高手装逼，没有固定的套路；普通人装逼，须要总结几个装逼路径：

- 炫耀一下你对Linux下各种命令的熟悉程度，对得起你所说的"一直使用Linux开发"，要是给出几个调整参数性能飙升的例子，逼就装大了（不包括内核哦）。
- 证明一下你是一个多线程高手，举例子说明提高的指标，要是能给出几个经验值，就更能说明你的份量
- 你是一个jvm高手，各种jdk小工具驾轻就熟，经常调整一些gc参数
- 业务高手，能够优化流程规避问题。这种价值最大但不好装逼，因为你的业务不太可能在短时间内说清楚，所以是装逼的最下策。


首先我们上一张Brendan Gregg大神的一张总结图。伟大的方校长已经将其隔离在长城之外，所以打不开网址的话，请不要骚扰我lol. http://www.brendangregg.com/index.html
Linux命令特别多,如果和Java联系起来，会更加没有条理。所以我们尽量关注最常用的部分，大部分Linux发行版都有，划线的命令暂不讨论。

![linux_observability_tools](/linux_observability_tools.png)
我们提倡活体解剖，即在Java进程还活着的时候给做个体检扫描，必要时给它几刀子。

远观：
- 查看磁盘使用 `df` 
- 查看cpu使用情况 `top`
- 查看内存使用情况 `free`

亵玩：
- 查看网络使用 `netstat`
- 查看进程信息 `top`
- 系统概况 `vmstat`

一般，登陆一台机器，我们会使用`uptime`来看一下系统的load。这个命令和top的第一行是一样的。那么问题来了，你知道load average是什么意思么？这是第一个知识点，一般当load/cpu核数大于`1`的时候，就证明你的cpu不够用了。如何看CPU核数呢，有两种方式，一种是进入`top`后，按下1键查看，一种是观察`/proc/cpuinfo`文件。
```
$ uptime!
 07:42:06 up  8:16,  1 user,  load average: 2.27, 2.84, 2.91!
```
然后使用`df -h`对磁盘的使用情况有一个大体的印象
![linux_observability_tools](/top-ps.png)
